<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agent Performance Dashboard</title>
  <style>
    :root{
      --card:#1b1d36; --text:#ffffff; --muted:rgba(255,255,255,.80);
      --border:rgba(255,255,255,.10); --ok:#20c997; --err:#ff6b6b;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:system-ui, Arial, sans-serif; color:var(--text); background:#0f1020; min-height:100vh; }

    header{
      display:flex; align-items:center; gap:12px; padding:16px 24px;
      background:rgba(27,29,54,.90); border-bottom:1px solid var(--border);
      position:sticky; top:0; z-index:5; backdrop-filter: blur(6px);
    }
    header img{ height:34px; width:auto; object-fit:contain; }
    header h1{ margin:0; font-size:18px; font-weight:600; }

    .wrap{ width: clamp(1024px, 96vw, 1600px); margin:0 auto; padding:0 8px 24px; }
    .top-actions{ padding:16px 0 12px; }
    a.btn{ display:inline-block; padding:10px 16px; background:#fff; color:#2e2a8f; border-radius:10px; text-decoration:none; font-weight:700; }

    /* Top filters */
    .filters{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:20px; align-items:stretch; }
    .box{
      background:rgba(27,29,54,.92); border:1px solid var(--border); border-radius:16px;
      padding:18px; display:flex; flex-direction:column; gap:12px; backdrop-filter: blur(4px);
    }
    .box h3{ margin:0; font-size:16px; font-weight:600; }
    .hint{ font-size:13px; color:var(--muted); margin-top:-6px; }
    .field{
      background:#0f1129; border:1px solid var(--border); border-radius:12px;
      padding:10px 12px; display:flex; align-items:center; gap:10px; position:relative;
    }
    label{ font-size:14px; color:var(--muted); white-space:nowrap; }
    select, input[type="text"]{ flex:1; background:transparent; color:#fff; border:none; outline:none; font-size:15px; min-width:0; }
    .toolbar{ display:grid; grid-template-columns: 1fr 110px; gap:10px; align-items:center; }
    .btn-reset{ padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:#0f1129; color:#fff; cursor:pointer; }

    /* Autocomplete dropdown */
    .ac-wrap{ position:relative; }
    .ac-list{
      position:absolute; left:0; right:0; top:calc(100% + 6px);
      background:#0f1129; border:1px solid var(--border); border-radius:12px;
      box-shadow:0 12px 32px rgba(0,0,0,.45); max-height:260px; overflow:auto; z-index:10; display:none;
    }
    .ac-list.open{ display:block; }
    .ac-item{ padding:10px 12px; font-weight:600; cursor:pointer; user-select:none; border-bottom:1px solid rgba(255,255,255,.05); }
    .ac-item:last-child{ border-bottom:none; }
    .ac-item:hover,.ac-item.active{ background:#1a1d3b; }
    .ac-empty{ padding:10px 12px; color:var(--muted); }

    /* Details */
    .detail-list{ display:grid; grid-template-columns: 140px 1fr; gap:8px 12px; }
    .d-label{ color:var(--muted); font-size:13px; }
    .d-value{ font-weight:600; }
    .badge{
      display:inline-block; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px; border:1px solid var(--border);
    }
    .badge.ok{ background:rgba(32,201,151,.15); color:#b3ffe8; border-color:rgba(32,201,151,.35); }
    .badge.err{ background:rgba(255,107,107,.15); color:#ffd4d4; border-color:rgba(255,107,107,.35); }

    /* Table only */
    .table-section{ margin-top:24px; display:none; }
    .table-card{ background:rgba(27,29,54,.92); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .table-title{ margin:0 0 12px; font-size:16px; font-weight:700; }
    .table-wrap{ overflow:auto; }
    table{ width:100%; border-collapse:separate; border-spacing:0; min-width:1180px; }
    thead th{
      position:sticky; top:0; background:#13142c; color:#fff; text-align:left; padding:10px 12px;
      border-bottom:1px solid var(--border); z-index:3;
    }
    tbody td{ padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.06); color:#e9e9f3; }
    tbody tr:hover{ background:rgba(255,255,255,.03); }
    .num{ text-align:right; white-space:nowrap; }
    .muted{ color:var(--muted); }

    /* Sticky highlighted totals row (just under header) */
    .totals-row td{
      position:sticky; top:40px; /* adjust if thead height changes */
      background:linear-gradient(0deg, rgba(255,255,255,.06), rgba(255,255,255,.08));
      font-weight:800; z-index:2; border-bottom-color:rgba(255,255,255,.18);
    }

    /* Surplus/Deficit colors */
    .surplus{ color:#a8f0c6; font-weight:700; }
    .deficit{ color:#ffb3b3; font-weight:700; }

    @media (max-width:1200px){ .filters{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width:640px){ .filters{ grid-template-columns:1fr; } .detail-list{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Realty Assistant logo" />
    <h1>Agent Performance Dashboard</h1>
  </header>

  <div class="wrap">
    <div class="top-actions">
      <a class="btn" href="index.html">← Back to Welcome</a>
    </div>

    <!-- Filters -->
    <section class="filters">
      <!-- Role -->
      <div class="box">
        <h3>Please select Role Type</h3>
        <p class="hint">Role Types: FOS, Team Leader, Area Manager, President</p>
        <div class="field">
          <label for="role">Role</label>
          <select id="role" aria-label="Select Role">
            <option value="FOS">FOS</option>
            <option value="Team Leader">Team Leader</option>
            <option value="Area Manager">Area Manager</option>
            <option value="President">President</option>
          </select>
        </div>
      </div>

      <!-- Name (Search) -->
      <div class="box">
        <h3>Please select or Search Name</h3>
        <p class="hint">Type to search, then press Enter or click</p>
        <div class="toolbar">
          <div class="field ac-wrap">
            <label for="search">Search</label>
            <input id="search" type="text" placeholder="Search name..." autocomplete="off" aria-expanded="false" aria-controls="ac-list" />
            <div id="ac-list" class="ac-list" role="listbox" aria-label="Name suggestions"></div>
          </div>
          <button class="btn-reset" id="resetFilters" type="button">Reset</button>
        </div>
      </div>

      <!-- Details -->
      <div class="box">
        <h3>Employee Details</h3>
        <div class="detail-list">
          <div class="d-label">City</div>        <div class="d-value" id="dCity">—</div>
          <div class="d-label">Status</div>      <div class="d-value" id="dStatus">—</div>
          <div class="d-label">DOJ</div>         <div class="d-value" id="dDOJ">—</div>
          <div class="d-label" id="dolLabel" style="display:none;">DOL</div>
          <div class="d-value" id="dDOL" style="display:none;">—</div>
          <div class="d-label">Employee Code</div><div class="d-value" id="dCode">—</div>
          <div class="d-label">Last Salary</div> <div class="d-value" id="dSalary">—</div>
        </div>
      </div>
    </section>

    <!-- FOS table -->
    <section id="fosTableSection" class="table-section">
      <div class="table-card">
        <h3 class="table-title">Monthly Performance (FOS)</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Month</th>
                <th class="num">Total Units</th>
                <th class="num">Cancelled Units</th>
                <th class="num">Active Units</th>
                <th class="num">Salary</th>
                <th class="num">Marketing Expense</th>
                <th class="num">Revenue</th>
                <th class="num">Salary × 5</th>
                <th class="num">X Achieved</th>
                <th class="num">Surplus / Deficit</th>
              </tr>
            </thead>
            <tbody id="fosTbody"></tbody>
          </table>
        </div>
        <p class="muted" id="fosNote" style="margin-top:8px;"></p>
      </div>
    </section>
  </div>

  <script>
    /* ===== Employee master ===== */
    const employees = {
      "FOS": {
        "A": { city: "Noida",     status: "Active",   doj: "2024-02-10", dol: null,        code: "RA-FOS-001", salary: 30000 },
        "B": { city: "Ghaziabad", status: "Inactive", doj: "2023-05-15", dol: "2024-11-20", code: "RA-FOS-002", salary: 28000 },
        "C": { city: "Lucknow",   status: "Active",   doj: "2024-07-01", dol: null,        code: "RA-FOS-003", salary: 32000 }
      },
      "Team Leader": {
        "D": { city: "Noida",   status: "Active",   doj: "2022-03-05", dol: null,        code: "RA-TL-010", salary: 45000 },
        "E": { city: "Delhi",   status: "Inactive", doj: "2021-08-20", dol: "2023-12-31", code: "RA-TL-011", salary: 42000 },
        "F": { city: "Gurgaon", status: "Active",   doj: "2023-11-11", dol: null,        code: "RA-TL-012", salary: 47000 }
      },
      "Area Manager": {
        "G": { city: "Noida",   status: "Active",   doj: "2020-06-15", dol: null,        code: "RA-AM-101", salary: 65000 },
        "H": { city: "Kanpur",  status: "Inactive", doj: "2019-04-10", dol: "2022-10-05", code: "RA-AM-102", salary: 60000 },
        "I": { city: "Lucknow", status: "Active",   doj: "2021-01-20", dol: null,        code: "RA-AM-103", salary: 68000 }
      },
      "President": {
        "X": { city: "Noida", status: "Active",   doj: "2016-02-01", dol: null,        code: "RA-PR-901", salary: 150000 },
        "Y": { city: "Mumbai",status: "Active",   doj: "2018-09-10", dol: null,        code: "RA-PR-902", salary: 155000 },
        "Z": { city: "Delhi", status: "Inactive", doj: "2015-01-15", dol: "2024-03-31", code: "RA-PR-903", salary: 148000 }
      }
    };

    /* ===== Sample monthly data for FOS ===== */
    const perfFOS = {
      "A": {
        "2024-02": { total: 3, cancelled: 1, marketing: 5000, revenue: 90000 },
        "2024-03": { total: 4, cancelled: 0, marketing: 6000, revenue: 120000 },
        "2024-04": { total: 2, cancelled: 1, marketing: 4000, revenue: 60000 }
      },
      "B": {
        "2023-06": { total: 2, cancelled: 0, marketing: 3000, revenue: 70000 },
        "2023-07": { total: 3, cancelled: 1, marketing: 3500, revenue: 80000 },
        "2024-10": { total: 1, cancelled: 0, marketing: 2000, revenue: 30000 }
      },
      "C": {
        "2024-07": { total: 1, cancelled: 0, marketing: 2500, revenue: 35000 },
        "2024-08": { total: 2, cancelled: 0, marketing: 3000, revenue: 70000 },
        "2024-09": { total: 3, cancelled: 1, marketing: 3200, revenue: 85000 }
      }
    };

    /* ===== Elements ===== */
    const roleSel     = document.getElementById('role');
    const searchInput = document.getElementById('search');
    const acList      = document.getElementById('ac-list');
    const resetBtn    = document.getElementById('resetFilters');

    const dCity   = document.getElementById('dCity');
    const dStatus = document.getElementById('dStatus');
    const dDOJ    = document.getElementById('dDOJ');
    const dDOL    = document.getElementById('dDOL');
    const dCode   = document.getElementById('dCode');
    const dSalary = document.getElementById('dSalary');
    const dolLabel= document.getElementById('dolLabel');

    const fosSection = document.getElementById('fosTableSection');
    const fosTbody   = document.getElementById('fosTbody');
    const fosNote    = document.getElementById('fosNote');

    /* ===== State & helpers ===== */
    let state = { role: roleSel.value, name: null };
    let acIndex = -1;

    const fmtDate = (iso)=> !iso ? '—' : new Date(iso+"T00:00:00").toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
    const fmtINR  = (n)=> n==null ? '—' : n.toLocaleString('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0});
    const fmtX    = (x)=> isFinite(x) ? (Math.round(x*100)/100).toFixed(2) + '×' : '—';

    function namesForRole(role){ return Object.keys(employees[role] || []); }
    function filterNames(q){ const list = namesForRole(state.role); if(!q) return list; q=q.toLowerCase(); return list.filter(n=>n.toLowerCase().includes(q)); }

    /* Month range DOJ→DOL (or current month if active) */
    function monthRange(doj, dol){
      const start = new Date(doj.slice(0,7)+"-01T00:00:00");
      const end = dol ? new Date(dol.slice(0,7)+"-01T00:00:00") : new Date(new Date().getFullYear(), new Date().getMonth(), 1);
      const arr = []; const d = new Date(start);
      while(d <= end){
        const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,'0');
        arr.push({ key: `${y}-${m}`, label: d.toLocaleString('en-IN',{month:'short', year:'numeric'}) });
        d.setMonth(d.getMonth()+1);
      }
      return arr;
    }

    /* ===== Autocomplete ===== */
    function openAC(items){
      acList.innerHTML = items.length
        ? items.map((n,i)=>`<div class="ac-item${i===0?' active':''}" role="option">${n}</div>`).join('')
        : `<div class="ac-empty">No names found</div>`;
      acList.classList.add('open'); searchInput.setAttribute('aria-expanded','true'); acIndex = items.length?0:-1;
      [...acList.querySelectorAll('.ac-item')].forEach(el=>{
        el.addEventListener('mousedown', (e)=>{ e.preventDefault(); selectName(el.textContent.trim()); });
      });
    }
    function closeAC(){ acList.classList.remove('open'); searchInput.setAttribute('aria-expanded','false'); acIndex=-1; }
    function refreshAC(){ openAC(filterNames(searchInput.value.trim())); }
    function moveActive(delta){
      const items = [...acList.querySelectorAll('.ac-item')]; if(!items.length) return;
      acIndex = (acIndex + delta + items.length) % items.length;
      items.forEach(el=>el.classList.remove('active')); items[acIndex].classList.add('active'); items[acIndex].scrollIntoView({block:'nearest'});
    }
    function selectActive(){ const el = acList.querySelectorAll('.ac-item')[acIndex]; if(el) selectName(el.textContent.trim()); }

    /* ===== Selection + details ===== */
    function selectName(name){
      state.name = name; searchInput.value = name; closeAC();
      updateDetails(); renderFOSTable();
    }

    function updateDetails(){
      const data = (employees[state.role] || {})[state.name || ''] || null;
      if(!data){
        dCity.textContent='—'; dStatus.textContent='—'; dStatus.className='';
        dDOJ.textContent='—'; dDOL.textContent='—'; dCode.textContent='—'; dSalary.textContent='—';
        dolLabel.style.display='none'; dDOL.style.display='none'; return;
      }
      dCity.textContent = data.city || '—';
      dStatus.textContent = data.status || '—';
      dStatus.className = 'badge ' + (data.status === 'Active' ? 'ok' : 'err');
      dDOJ.textContent = fmtDate(data.doj);
      if(String(data.status).toLowerCase()==='inactive' && data.dol){
        dolLabel.style.display=''; dDOL.style.display=''; dDOL.textContent = fmtDate(data.dol);
      } else { dolLabel.style.display='none'; dDOL.style.display='none'; dDOL.textContent='—'; }
      dCode.textContent = data.code || '—';
      dSalary.textContent = fmtINR(data.salary);
    }

    /* ===== FOS table render (sticky totals row, factor & surplus/deficit) ===== */
    function renderFOSTable(){
      if(state.role !== 'FOS' || !state.name){
        fosSection.style.display = 'none'; fosTbody.innerHTML = ''; fosNote.textContent = ''; return;
      }
      const emp = employees['FOS'][state.name];
      if(!emp){ fosSection.style.display = 'none'; return; }

      const months = monthRange(emp.doj, emp.dol);
      const monthly = (perfFOS[state.name] || {});
      const salary = emp.salary || 0;
      const perMonthTarget = salary * 5;

      // Totals across months
      let sumTotal=0, sumCancel=0, sumActive=0, sumMkt=0, sumRevenue=0;
      months.forEach(m=>{
        const r = monthly[m.key] || { total:0, cancelled:0, marketing:0, revenue:0 };
        const active = Math.max((r.total||0) - (r.cancelled||0), 0);
        sumTotal += (r.total||0);
        sumCancel+= (r.cancelled||0);
        sumActive+= active;
        sumMkt   += (r.marketing||0);
        sumRevenue += (r.revenue||0);
      });
      const monthsCount = months.length;
      const totalSalary = salary * monthsCount;
      const totalTarget = perMonthTarget * monthsCount;
      const xAchievedTotal = totalTarget ? (sumRevenue / totalTarget) : 0; // factor
      const surplusTotal = sumRevenue - totalTarget;

      const totalsRow = `
        <tr class="totals-row">
          <td>Total</td>
          <td class="num">${sumTotal}</td>
          <td class="num">${sumCancel}</td>
          <td class="num">${sumActive}</td>
          <td class="num">${fmtINR(totalSalary)}</td>
          <td class="num">${fmtINR(sumMkt)}</td>
          <td class="num">${fmtINR(sumRevenue)}</td>
          <td class="num">${fmtINR(totalTarget)}</td>
          <td class="num">${fmtX(xAchievedTotal)}</td>
          <td class="num ${surplusTotal>=0?'surplus':'deficit'}">${surplusTotal>=0?'+':''}${fmtINR(Math.abs(surplusTotal))}</td>
        </tr>`;

      // Month-wise rows
      const monthRows = months.map(m=>{
        const r = monthly[m.key] || { total:0, cancelled:0, marketing:0, revenue:0 };
        const activeUnits = Math.max((r.total||0) - (r.cancelled||0), 0);
        const xFactor = perMonthTarget ? ((r.revenue||0)/perMonthTarget) : 0; // factor
        const surplus = (r.revenue||0) - perMonthTarget;

        return `<tr>
          <td>${m.label}</td>
          <td class="num">${r.total||0}</td>
          <td class="num">${r.cancelled||0}</td>
          <td class="num">${activeUnits}</td>
          <td class="num">${fmtINR(salary)}</td>
          <td class="num">${fmtINR(r.marketing||0)}</td>
          <td class="num">${fmtINR(r.revenue||0)}</td>
          <td class="num">${fmtINR(perMonthTarget)}</td>
          <td class="num">${fmtX(xFactor)}</td>
          <td class="num ${surplus>=0?'surplus':'deficit'}">${surplus>=0?'+':''}${fmtINR(Math.abs(surplus))}</td>
        </tr>`;
      }).join('');

      fosTbody.innerHTML = totalsRow + monthRows;
      fosNote.textContent = ``;
      fosSection.style.display = 'block';
    }

    function resetAll(){ searchInput.value=''; state.name=null; closeAC(); updateDetails(); renderFOSTable(); searchInput.focus(); }

    // Init
    (function init(){
      const first = namesForRole(state.role)[0] || null;
      if(first){ state.name = first; searchInput.value = first; }
      updateDetails(); renderFOSTable();
    })();

    // Events
    roleSel.addEventListener('change', e=>{
      state.role=e.target.value; state.name=null; searchInput.value='';
      closeAC(); updateDetails(); renderFOSTable();
    });
    searchInput.addEventListener('focus', ()=>{ refreshAC(); });
    searchInput.addEventListener('input', ()=>{ refreshAC(); });
    searchInput.addEventListener('keydown', (e)=>{
      if(!acList.classList.contains('open')){
        if(e.key.length===1 || e.key==='Backspace' || e.key==='Delete' || e.key==='ArrowDown'){ refreshAC(); }
      }
      if(e.key==='ArrowDown'){ e.preventDefault(); moveActive(+1); }
      else if(e.key==='ArrowUp'){ e.preventDefault(); moveActive(-1); }
      else if(e.key==='Enter'){ e.preventDefault(); selectActive(); }
      else if(e.key==='Escape'){ closeAC(); }
    });
    document.addEventListener('click', (e)=>{ if(!e.target.closest('.ac-wrap')) closeAC(); });
    resetBtn.addEventListener('click', resetAll);
  </script>
</body>
</html>
